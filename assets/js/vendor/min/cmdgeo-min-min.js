(function(){function t(t){return null!==t}function n(n){return n!==!1&&t(n)}function e(){return void 0!==typeof Storage?F.storage=sessionStorage:!1}function o(){return H(F.settings)}function i(){return geo_position_js.init()}function r(t){return H(F.storage[t])}function a(t){return r(t.name)}function s(t){return"false"===F.storage.getItem(t.name)}function u(t){return _.isString(t.onEnter)&&t.onEnter.length>0}function p(t){return H(t.onExit)&&_.isString(t.onExit)&&t.onExit.length>0}function c(t){var n=g();return n.open("GET",t,!1),n.send(null),JSON.parse(n.responseText)}function g(){return x(window.XMLHttpRequest)||x(window.ActiveXObject)||L("Your platform doesn't support HTTP request objects")}function l(t){S(Z(),L),_.each(K(t),function(t){return t.name in F.storage?!1:F.storage.setItem(t.name,!1)})}function m(t){return t*(Math.PI/180)}function f(t,n){return 6376136*Math.acos(Math.sin(m(t.latitude))*Math.sin(m(n.latitude))+Math.cos(m(t.latitude))*Math.cos(m(n.latitude))*Math.cos(m(n.longitude)-m(t.longitude)))}function d(){return geo_position_js.getCurrentPosition(h,function(t,n){L(["geo.js",t,n].join(" "))},{enableHighAccuracy:!0})}function h(t){setTimeout(d,500),void 0!==F.map&&T(t);var n=y(t.coords);n?s(n)&&k(n):(n=w(),n&&v(n))}function y(t){return _.find(K(F.settings),function(n){return f(t,n.coordinate)<n.radius},!1)||!1}function k(t){return S(nn(t),C)?void 0:M(t)}function v(t){return S(en(t),C)?I(t,!1):E(t)}function w(){return _.find(K(F.settings),function(t){return t.name===_.find(_.keys(F.storage),function(t){return"true"===F.storage[t]})})}function M(t){I(t,!0),window.location=t.onEnter}function E(t){I(t,!1),window.location=t.onExit}function I(t,n){C(t.name+(n?" activated":" deactivated")),F.storage.setItem(t.name,n)}function b(){F.settings.mapOptions.center=new google.maps.LatLng(F.settings.mapOptions.center[0],F.settings.mapOptions.center[1]),F.settings.mapOptions.mapTypeId=google.maps.MapTypeId[F.settings.mapOptions.mapTypeId],F.settings.posMarker.path=google.maps.SymbolPath[F.settings.posMarker.path],F.settings.poiMarker.path=google.maps.SymbolPath[F.settings.poiMarker.path]}function O(){if(F.map.route=_.map(K(F.settings),function(t){return new google.maps.LatLng(t.coordinate.latitude,t.coordinate.longitude)}),F.map.markers=_.map(K(F.settings),function(t,n){return new google.maps.Marker({position:F.map.route[n],map:F.map,icon:z(F.settings),title:t.name})}),"LINEAIR"===q(F.settings))var t=new google.maps.Polyline({clickable:!1,map:F.map,path:F.map.route,strokeColor:"Black",strokeOpacity:.6,strokeWeight:3});F.map.pm=new google.maps.Marker({position:X(F.settings).center,map:F.map,icon:J(F.settings)})}function T(t){F.map.pm.setPosition(new google.maps.LatLng(t.coords.latitude,t.coords.longitude)),F.map.setCenter(F.map.pm.position)}function S(t,n){return t.length>0?!n(t):!1}function L(t){throw new Error(t)}function A(t){console.log(["WARNING:",t].join(" "))}function C(t){console.log(["NOTE:",t].join(" "))}function R(t){return function(){return t}}function j(t){return function(){return!t.apply(null,_.toArray(arguments))}}function P(t,e,o){return n(t)?e():o()}function x(n){return P(t(n),function(){return new n})}function N(n){var e=_.rest(arguments);return function(){return n.apply(null,_.map(arguments,function(n,o){return t(n)?n:e[o]}))}}function B(t){return function(n,e){var o=N(_.identity,t[e]);return n&&o(n[e])}}function U(t,n){return function(e){return B(n)(e,t)}}function W(){var t=_.toArray(arguments);return function(n){return _.reduce(t,function(t,e){return e(n)?t:_.chain(t).push(e.message).value()},[])}}function G(t,n){var e=function(){return n.apply(n,arguments)};return e.message=t,e}var D={googleMapsKey:"",tourType:"LINEAIR",mapOptions:{center:[52.35955620231157,4.908019635968003],zoom:15,mapTypeId:"ROADMAP"},poiMarker:{path:"CIRCLE",fillColor:"GhostWhite",strokeColor:"FireBrick"},posMarker:{path:"BACKWARD_CLOSED_ARROW",fillColor:"FireBrick",strokeColor:"Black"},poiList:[]},F=function(t){return t instanceof F?t:this instanceof F?void(this.cmdgeowrapped=t):new F(t)};this.cmdgeo=F,F.VERSION=.2,F.storage=F.settings=F.map=void 0;var H=j(_.isUndefined),K=U("poiList",D),q=U("tourType",D),X=U("mapOptions",D),z=U("poiMarker",D),J=U("posMarker",D),V=U("googleMapsKey",D),Y=G("Failing deliberately",R(!1)),Q=W(),Z=W(G("Storage (localStorage/ sessionStorage) is not supported on your system, this app can't live without it.",e)),tn=W(G("Unable to find settings, did you load them before calling the track() function?.",o),G("Unable to initialise GPS, this app can't live without it.",i)),nn=W(G("Unable to find poi in storage, are you sure it's in your settings file?",a),G("The poi does not have an onEnter property.",u),G("The poi has to be inactive!",s)),en=W(G("Unable to find poi in storage, are you sure it's in your settings file?",a),G("The poi does not have an onExit property.",p));F.loadSettings=function on(t){F.settings=c(t),S(Q(F.settings),L),l(F.settings)},F.track=function rn(){S(tn(),L),d()},F.loadmap=function an(){var t=document.createElement("script");t.src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=true&key="+V(F.settings)+"&callback=cmdgeo.drawmap",document.body.appendChild(t)},F.drawmap=function sn(){b(),F.map=new google.maps.Map(document.getElementById("map_canvas"),X(F.settings)),O()}}).call(this);